{"version":3,"file":"swf-viewer.js","sourceRoot":"","sources":["../src/viewer/transportPeer.ts","../src/viewer/shuobject.ts"],"names":[],"mappings":"AASA;IAKI,0BAAY,MAAc,EAAE,MAAc,EAAE,IAAY;QACpD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACtB,CAAC;IAED,sBAAI,4CAAc;aAAlB,UAAmB,QAA4B;YAC3C,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,UAAC,CAAC;gBACtC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAC,GAAG;oBAC7B,kDAAkD;oBAClD,QAAQ,CAAC,GAAG,CAAC,CAAC;gBAClB,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACP,CAAC;;;OAAA;IAED,sBAAI,2CAAa;aAAjB,UAAkB,QAA2B;YACzC,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,aAAa,EAAE,UAAC,CAAC;gBAC1C,IAAI,cAAc,GAAS,CAAE,CAAC,MAAM,CAAC;gBACrC,IAAI,GAAG,GAAQ,cAAc,CAAC,GAAG,CAAC;gBAClC,iDAAiD;gBACjD,cAAc,CAAC,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;QACP,CAAC;;;OAAA;IAGD,2CAAgB,GAAhB,UAAiB,GAAQ,EAAE,SAAiB;QACxC,2DAA2D;QAC3D,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC;IACjD,CAAC;IAED,0CAAe,GAAf,UAAgB,GAAQ,EAAE,SAAiB;QACvC,0DAA0D;QAC1D,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QAC5D,IAAI,cAAc,GAAG;YACjB,GAAG,EAAE,GAAG;YACR,MAAM,EAAE,SAAgB;SAC3B,CAAC;QACF,KAAK,CAAC,eAAe,CAAC,aAAa,EAAE,KAAK,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC;QACnE,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACjC,MAAM,CAAC,cAAc,CAAC,MAAM,CAAC;IACjC,CAAC;IACL,uBAAC;AAAD,CAAC,AA9CD,IA8CC;AAGD;IAOI,4BAAY,GAAW,EAAE,IAAY;QAJ7B,aAAQ,GAAuB,IAAI,CAAC;QAEpC,UAAK,GAAW,IAAI,CAAC;QAGzB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,OAAO,CAAC,GAAG,CAAC,gCAAgC,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,KAAK,EAAE,UAAU,EAAE,kBAAkB,CAAC,QAAQ,CAAC,CAAC;QAChH,kBAAkB,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAI,OAAO,GAAG,kBAAkB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QACjD,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACV,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;YACxB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;YACxB,OAAO,kBAAkB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAC1C,OAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;QACjD,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,kBAAkB,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;YAC1C,OAAO,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;QACrD,CAAC;IACL,CAAC;IAED,sBAAI,8CAAc;aAAlB,UAAmB,QAA4B;YAA/C,iBAUC;YATG,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,UAAC,CAAC;gBACjC,IAAI,UAAU,GAAG,CAAC,CAAC,IAAI,CAAC;gBACxB,EAAE,CAAC,CAAC,KAAI,CAAC,gCAAgC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;oBACpD,IAAI,KAAG,GAAG,UAAU,CAAC,OAAO,CAAC;oBAC7B,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;wBACnB,QAAQ,CAAC,KAAG,CAAC,CAAC;oBAClB,CAAC,CAAC,CAAC;gBACP,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;;;OAAA;IAEO,6DAAgC,GAAxC,UAAyC,GAAQ;QAC7C,EAAE,CAAC,CAAC,MAAM,IAAI,GAAG,IAAI,SAAS,IAAI,GAAG,CAAC,CAAC,CAAC;YACpC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAChB,EAAE,CAAC,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;oBAClC,MAAM,CAAC,IAAI,CAAC;gBAChB,CAAC;YACL,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,mCAAmC,EAAE,GAAG,CAAC,IAAI,EAAE,+BAA+B,CAAC,CAAC;YAC5G,CAAC;QACL,CAAC;QACD,MAAM,CAAC,KAAK,CAAC;IACjB,CAAC;IAED,6CAAgB,GAAhB,UAAiB,GAAQ,EAAE,SAAiB;QACxC,2DAA2D;QAC3D,IAAI,OAAO,GAAG,IAAI,mBAAmB,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACvD,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC;IAChD,CAAC;IAED,sBAAI,6CAAa;aAAjB,UAAkB,QAA2B;YACzC,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC;QAClC,CAAC;;;OAAA;IAED,4CAAe,GAAf,UAAgB,GAAQ,EAAE,SAAiB;QACvC,0DAA0D;QAC1D,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC;QAClE,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACX,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QACzB,CAAC;IACL,CAAC;IA/Dc,6BAAU,GAA0C,EAAE,CAAC;IACvD,2BAAQ,GAAW,CAAC,CAAC;IA+DxC,yBAAC;CAAA,AAjED,IAiEC;AAED;IAGI,6BAAmB,OAAY,EAAE,IAAY;QACzC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACrB,CAAC;IACL,0BAAC;AAAD,CAAC,AAPD,IAOC;ACpID,uBAAuB;AACvB,8DAA8D;AAC9D,4EAA4E;AAC5E;IASE;QAHQ,2BAAsB,GAAG,QAAQ,CAAC,aAAa,CAAC;QAItD,oEAAoE;QACpE,IAAI,CAAC,kBAAkB,GAAG,CAAC,QAAQ,CAAC,IAAI,IAAI,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAA8B,CAAC;QACrH,IAAI,CAAC,YAAY,GAAG,UAAU,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACjE,wCAAwC;QACxC,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACzF,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC;IACpC,CAAC;IACO,mCAAW,GAAnB,UAAoB,MAAM;QAA1B,iBAeC;QAdC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC;YAChC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,UAAC,CAAC;gBACnC,IAAI,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC;gBAClB,EAAE,CAAC,CAAC,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,KAAK,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,oBAAoB,CAAC,CAAC,CAAC;oBACpF,MAAM,CAAC;gBACT,CAAC;gBACD,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;oBAC1C,MAAM,CAAC;gBACT,CAAC;gBACD,eAAe,CAAC,IAAI,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;YAC5C,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,qBAAqB,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QACnD,CAAC;QACD,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;IAC5C,CAAC;IAED,yBAAyB;IACjB,kCAAU,GAAlB,UAAmB,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU;QACzE,IAAI,QAAQ,CAAC;QACb,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;YACf,MAAM,GAAG,MAAM,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC;YACtC,EAAE,GAAG,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;YAC5B,KAAK,GAAG,KAAK,IAAI,UAAU,CAAC,OAAO,CAAC,CAAC;YACrC,MAAM,GAAG,MAAM,IAAI,UAAU,CAAC,QAAQ,CAAC,CAAC;YACxC,QAAQ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC;QAED,IAAI,SAAS,GAAG,UAAU,CAAC,IAAI,CAAC,YAAY,EAAE,oBAAoB,CAAC,CAAC;QACpE,IAAI,cAAc,GAAG,UAAU,CAAC,eAAe,EAAE,EAAE,MAAM,CAAC,CAAC;QAE3D,IAAI,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACrD,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;YACV,aAAa,CAAC,KAAK,GAAG,KAAK,CAAC;QAC9B,CAAC;QACD,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACX,aAAa,CAAC,MAAM,GAAG,MAAM,CAAC;QAChC,CAAC;QACD,aAAa,CAAC,YAAY,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QACrC,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;YACf,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,UAAC,IAAI;gBACnC,MAAM,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;oBAC3B,KAAK,YAAY;wBACf,aAAa,CAAC,YAAY,CAAC,OAAO,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;wBACtD,KAAK,CAAC;oBACR,KAAK,OAAO,CAAC;oBACb,KAAK,MAAM,CAAC;oBACZ,KAAK,OAAO;wBACV,aAAa,CAAC,YAAY,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;wBACnD,KAAK,CAAC;gBACV,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC;QAED,IAAI,YAAY,GAAG,EAAE,CAAC;QACtB,IAAI,SAAS,CAAC;QACd,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACX,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,UAAC,IAAI;gBAC/B,IAAI,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;gBAC1B,EAAE,CAAC,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC,CAAC;oBACzB,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;wBACf,SAAS,GAAG,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;oBAC7C,CAAC;gBACH,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC;oBAC3B,oDAAoD;oBACpD,SAAS,GAAG,UAAU,CAAC,eAAe,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;gBAC1D,CAAC;gBACD,YAAY,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;YACpC,CAAC,CAAC,CAAC;QACL,CAAC;QACD,IAAI,WAAW,GAAG,EAAE,CAAC;QACrB,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;YACd,IAAI,cAAc,GAAG,EAAE,CAAC;YACxB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,UAAC,IAAI;gBAClC,WAAW,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;gBACpC,cAAc,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,GAAG,GAAG,GAAG,kBAAkB,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC5F,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC9B,YAAY,CAAC,WAAW,CAAC,GAAG,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACvD,CAAC;QACH,CAAC;QAED,IAAI,YAAY,GAAG;YACjB,OAAO,EAAE,SAAS,IAAI,eAAe,EAAE;YACvC,GAAG,EAAE,cAAc;YACnB,WAAW,EAAE,WAAW;YACxB,YAAY,EAAE,YAAY;YAC1B,QAAQ,EAAE,IAAI,CAAC,cAAc;SAC9B,CAAC;QACF,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;YACxB,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC;QACzC,CAAC;QACD,aAAa,CAAC,GAAG,GAAG,SAAS,CAAC;QAC9B,aAAa,CAAC,YAAY,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC;QAC/C,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACb,aAAa,CAAC,YAAY,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;QAChD,CAAC;QACD,IAAI,IAAI,GAAG,UAAC,CAAC;YACX,aAAa,CAAC,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAChD,aAAa,CAAC,aAAa,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,cAAc,EAAE,WAAW,EAAE,YAAY,EAAE,EAAE,GAAG,CAAC,CAAC;QACpG,CAAC,CAAA;QACD,aAAa,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAC7C,MAAM,CAAC,aAAoB,CAAC;IAC9B,CAAC;IAED,oDAAoD;IAC5C,iCAAS,GAAjB,UAAkB,OAAO,EAAE,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU;QAA/F,iBAwBC;QAvBC,IAAI,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC;QAC9F,IAAI,IAAI,GAAG,UAAC,CAAC;YACX,aAAa,CAAC,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAChD,EAAE,CAAC,CAAC,KAAI,CAAC,cAAc,CAAC,CAAC,CAAC;gBACxB,kEAAkE;gBAClE,uEAAuE;gBACvE,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;oBACf,UAAU,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,EAAE,aAAa,CAAC,EAAE,EAAE,GAAG,EAAE,aAAa,EAAE,CAAC,CAAC;gBAC1E,CAAC;gBACD,MAAM,CAAC;YACT,CAAC;YACD,IAAI,eAAe,GAAG,aAAa,CAAC,eAAe,CAAC;YACpD,IAAI,OAAO,GAAG,UAAA,CAAC;gBACb,eAAe,CAAC,mBAAmB,CAAC,gBAAgB,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;gBACrE,aAAa,CAAC,OAAO,GAAG,IAAI,eAAe,CAAC,aAAa,CAAC,CAAC;gBAC3D,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;oBACf,UAAU,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,EAAE,aAAa,CAAC,EAAE,EAAE,GAAG,EAAE,aAAa,EAAE,CAAC,CAAC;gBAC1E,CAAC;YACH,CAAC,CAAA;YACD,eAAe,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;QACpE,CAAC,CAAA;QACD,aAAa,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAC7C,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;IAC1D,CAAC;IAED,qEAAqE;IAC7D,oCAAY,GAApB,UAAqB,OAAO,EAAE,EAAE,EAAE,UAAU;QAC1C,oBAAoB;QACpB,IAAI,KAAK,GAAG,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;QAC1C,IAAI,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;QAC5C,IAAI,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC1C,IAAI,UAAU,GAAG;YACf,EAAE,EAAE,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC;YAC9B,IAAI,EAAE,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;YAClC,OAAO,EAAE,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC;YACtC,KAAK,EAAE,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC;YACpC,KAAK,EAAE,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC;SACrC,CAAC;QACF,IAAI,UAAU,GAAG,OAAO,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QACvD,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YAC3C,IAAI,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;YACnD,IAAI,UAAU,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;YACrD,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;gBACf,QAAQ,CAAC;YACX,CAAC;YACD,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,GAAG,UAAU,CAAC;QAC/C,CAAC;QACD,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACZ,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;QAC5C,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;IAChG,CAAC;IAEO,oDAA4B,GAApC;QAAA,iBAmBC;QAlBC,IAAI,OAAO,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;QACzE,IAAI,QAAQ,GAAG,IAAI,gBAAgB,CAAC,UAAC,SAAS;YAC5C,GAAG,CAAC,CAAiB,UAAS,EAAT,uBAAS,EAAT,uBAAS,EAAT,IAAS;gBAAzB,IAAI,QAAQ,kBAAA;gBACf,IAAI,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAC;gBACrC,EAAE,CAAC,CAAC,CAAC,UAAU,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;oBAC3C,KAAK,CAAC;gBACR,CAAC;gBACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;oBAC3C,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,OAAO,CAAC,CAAC,CAAC;wBAC9B,KAAI,CAAC,YAAY,CAAC,OAAO,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;wBACjD,QAAQ,CAAC,UAAU,EAAE,CAAC;wBACtB,KAAK,CAAC;oBACR,CAAC;gBACH,CAAC;aACF;YAAA,CAAC;QACJ,CAAC,CAAC,CAAC;QACH,QAAQ,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QAC/D,MAAM,CAAC,OAAO,CAAC;IACjB,CAAC;IAKD,sBAAI,sCAAW;QAHf;;WAEG;aACH;YACE,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;QAC3B,CAAC;aAED,UAAgB,KAAK;YACnB,IAAI,CAAC,YAAY,GAAG,UAAU,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAChE,CAAC;;;OAJA;IAYD,sBAAI,wCAAa;QANjB;;;;;WAKG;aACH;YACE,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC;QAC7B,CAAC;aAED,UAAkB,KAAK;YACrB,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC,KAAK,CAAC;QAChC,CAAC;;;OAJA;IAMM,sCAAc,GAArB,UAAsB,EAAE,EAAE,OAAO,EAAE,oBAAoB,EAAE,UAAU;QAAnE,iBAQC;QAPC,UAAU,CAAC;YACT,IAAI,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;YAC1C,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;gBACb,MAAM,IAAI,KAAK,CAAC,UAAU,GAAG,EAAE,GAAG,gBAAgB,CAAC,CAAC;YACtD,CAAC;YACD,KAAI,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE,EAAE,UAAU,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACL,CAAC;IACM,gCAAQ,GAAf,UAAgB,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,oBAAoB,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU;QAAnH,iBAQC;QAPC,UAAU,CAAC;YACT,IAAI,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;YAC1C,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;gBACb,MAAM,IAAI,KAAK,CAAC,UAAU,GAAG,EAAE,GAAG,gBAAgB,CAAC,CAAC;YACtD,CAAC;YACD,KAAI,CAAC,SAAS,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;QAChG,CAAC,CAAC,CAAC;IACL,CAAC;IACM,qCAAa,GAApB,UAAqB,EAAE;QACrB,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;IACrC,CAAC;IACM,6CAAqB,GAA5B;QACE,MAAM,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC;IAC7C,CAAC;IACM,6CAAqB,GAA5B,UAA6B,OAAO;QAClC,MAAM,CAAC,IAAI,CAAC;IACd,CAAC;IACM,oCAAY,GAAnB,UAAoB,EAAE;QACpB,UAAU,CAAC,EAAE,CAAC,CAAC;IACjB,CAAC;IACM,uCAAe,GAAtB,UAAuB,EAAE;QACvB,UAAU,CAAC,EAAE,CAAC,CAAC;IACjB,CAAC;IACM,iCAAS,GAAhB,UAAiB,UAAU,EAAE,MAAM,EAAE,EAAE;QACrC,IAAI,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;QAC1C,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,UAAU,GAAG,EAAE,GAAG,gBAAgB,CAAC,CAAC;QACtD,CAAC;QACD,IAAI,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,EAAE,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC;QACxG,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;QACxD,MAAM,CAAC,aAAa,CAAC;IACvB,CAAC;IACM,iCAAS,GAAhB,UAAkB,EAAE;QAClB,IAAI,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;QAC1C,OAAO,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;IAC1C,CAAC;IACM,qCAAa,GAApB,UAAsB,UAAU,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,UAAU;QAC1E,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,kBAAkB,CAAC,UAAU,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC,CAAC;IACzG,CAAC;IAEM,qCAAa,GAApB,UAAsB,IAAI;QACxB,EAAE,CAAC,CAAC,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,WAAW,EAAE,KAAK,QAAQ,CAAC,CAAC,CAAC;YAChE,MAAM,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAChE,CAAC;QACD,MAAM,CAAC,IAAI,CAAC,4BAA4B,EAAE,CAAC;IAC7C,CAAC;IACM,wCAAgB,GAAvB,UAAwB,WAAW;QACjC,IAAI,OAAO,GAAG,OAAO,WAAW,KAAK,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;QACnG,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,UAAU,GAAG,WAAW,GAAG,gBAAgB,CAAC,CAAC;QAC/D,CAAC;QACD,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC;IACzB,CAAC;IACM,0CAAkB,GAAzB,UAA0B,SAAS;QACjC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,kBAAkB,GAAG,gBAAgB,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACvE,CAAC;QACD,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;IAC5C,CAAC;IACM,4BAAI,GAAX,UAAY,KAAK,EAAE,mBAAmB;QACpC,KAAK,GAAG,KAAK,IAAI,KAAK,CAAC;QACvB,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,QAAQ,CAAC,aAAa,GAAG,UAAU,IAAI;YACrC,EAAE,CAAC,CAAC,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,WAAW,EAAE,KAAK,QAAQ,CAAC,CAAC,CAAC;gBAChE,MAAM,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;YAChE,CAAC;YACD,EAAE,CAAC,CAAC,KAAK,KAAK,KAAK,CAAC,CAAC,CAAC;gBACpB,MAAM,CAAC,IAAI,CAAC,4BAA4B,EAAE,CAAC;YAC7C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,MAAM,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;YAChE,CAAC;QACH,CAAC,CAAC;QACF,IAAI,UAAU,GAAG,iBAAiB,CAAC;QACnC,IAAI,YAAY,GAAG,+BAA+B,CAAC;QACnD,EAAE,CAAC,CAAC,mBAAmB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACjE,IAAI,QAAQ,GAAQ;gBAClB,WAAW,EAAE,iBAAiB;gBAC9B,QAAQ,EAAE,KAAK;gBACf,IAAI,EAAE,YAAY;aACnB,CAAC;YACF,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,YAAY,CAAC,GAAG,QAAQ,CAAC;YACpD,IAAI,MAAM,GAAG;gBACX,WAAW,EAAE,oCAAoC;gBACjD,QAAQ,EAAE,YAAY;gBACtB,MAAM,EAAE,CAAC;gBACT,IAAI,EAAE,UAAU;gBAChB,GAAG,EAAE,QAAQ;aACd,CAAC;YACF,QAAQ,CAAC,aAAa,GAAG,MAAM,CAAC;YAChC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC;QAChD,CAAC;IACH,CAAC;IAKH,oBAAC;AAAD,CAAC,AA1UD,IA0UC;AAED,IAAI,SAAS,GAAG,IAAI,aAAa,EAAE,CAAC;AAUpC,qEAAqE;AACrE,mDAAmD;AACnD;IASE,yBAAY,aAAsC;QAChD,IAAI,SAAS,GAAG,aAAa,CAAC,aAAa,CAAC,SAAS,CAAC;QACtD,IAAI,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC;QACpC,SAAS,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QACrE,SAAS,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QAE7E,IAAI,YAAY,GAAG,aAAa,CAAC,aAAa,CAAC,YAAY,CAAC;QAC5D,IAAI,wBAAwB,GAAG,YAAY,CAAC,uBAAuB,CAAC;QACpE,wBAAwB,CAAC,sBAAsB,GAAG,sBAAsB,CAAC,IAAI,CAAC,wBAAwB,EAAE,aAAa,CAAC,CAAC;QAEvH,IAAI,CAAC,GAAG,GAAG,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QACnC,IAAI,CAAC,KAAK,GAAG,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC;QACvC,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,OAAO,CAAC;QACpC,IAAI,CAAC,KAAK,GAAG,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC;QAC3C,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAE3B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;IAC1B,CAAC;IAEM,wCAAc,GAArB,UAAsB,OAAO;QAC3B,OAAO,GAAG,OAAO,IAAI,EAAE,CAAC;QACxB,IAAI,MAAM,GAAG,OAAO,CAAC,MAAM,IAAI,IAAI,CAAC;QACpC,IAAI,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC;QAC1C,IAAI,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC;QAE1C,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;QACjC,KAAK,CAAC,MAAM,EAAE,CAAC;QACf,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,EAAE,YAAY,EAAE,YAAY,CAAC,CAAC;IAC9D,CAAC;IACO,sCAAY,GAApB,UAAqB,aAAa;QAChC,IAAI,OAAO,GAAG,aAAa,CAAC,OAAO,CAAC,OAAO,CAAC;QAC5C,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACZ,OAAO,EAAE,CAAC;QACZ,CAAC;IACH,CAAC;IACO,0CAAgB,GAAxB,UAAyB,aAAa,EAAE,OAAO,EAAE,IAAI;QACnD,IAAI,WAAW,GAAG,aAAa,CAAC,OAAO,CAAC,WAAW,CAAC;QACpD,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;YAChB,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QACpC,CAAC;IACH,CAAC;IACH,sBAAC;AAAD,CAAC,AAnDD,IAmDC;AAED,4BAA4B,UAAU,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,UAAU;IAChF,IAAI,WAAW,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC,CAAC,QAAQ;IAC1D,IAAI,OAAO,GAAG,EAAE,CAAC;IAEjB,0BAA0B;IAC1B,IAAI,oBAAoB,GAAG,EAAE,CAAC;IAC9B,IAAI,MAAM,GAAG,oBAAoB,EAAE,UAAU,GAAG,CAAC,CAAC;IAClD,MAAM,GAAG,CAAC,MAAM,IAAI,oBAAoB,CAAC,CAAC;IAAC,UAAU,IAAI,oBAAoB,CAAC;IAC9E,OAAO,UAAU,GAAG,CAAC,EAAE,CAAC;QACtB,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;IACpD,CAAC;IACD,MAAM,GAAG,CAAC,MAAM,IAAI,oBAAoB,CAAC,GAAG,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC;IAAC,UAAU,IAAI,oBAAoB,CAAC;IAC7F,OAAO,UAAU,GAAG,CAAC,EAAE,CAAC;QACtB,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;IACpD,CAAC;IACD,MAAM,GAAG,CAAC,MAAM,IAAI,oBAAoB,CAAC,CAAC;IAAC,UAAU,IAAI,oBAAoB,CAAC;IAC9E,OAAO,UAAU,GAAG,CAAC,EAAE,CAAC;QACtB,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;IACpD,CAAC;IACD,MAAM,GAAG,CAAC,MAAM,IAAI,oBAAoB,CAAC,GAAG,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC;IAAC,UAAU,IAAI,oBAAoB,CAAC;IAC9F,OAAO,UAAU,GAAG,CAAC,EAAE,CAAC;QACtB,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;IACpD,CAAC;IACD,EAAE,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC;QACnB,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;IACnD,CAAC;IAED,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,EAAE,SAAS,GAAG,CAAC,CAAC,CAAC;IACvE,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,cAAc;IAClC,IAAI,iBAAiB,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;IACtC,OAAO,CAAC,IAAI,CAAC,iBAAiB,GAAG,GAAG,EAAE,iBAAiB,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACvF,EAAE,CAAC,CAAC,UAAU,KAAK,SAAS,CAAC,CAAC,CAAC;QAC7B,IAAI,iBAAiB,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;QACrC,OAAO,CAAC,IAAI,CAAC,iBAAiB,GAAG,GAAG,EAAE,iBAAiB,IAAI,CAAC,EAC1D,CAAC,UAAU,IAAI,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,UAAU,IAAI,CAAC,CAAC,GAAG,GAAG,EAAE,UAAU,GAAG,GAAG,CAAC,CAAC;IACzE,CAAC;IACD,IAAI,YAAY,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;IAChC,OAAO,CAAC,IAAI,CAAC,YAAY,GAAG,GAAG,EAAE,YAAY,IAAI,CAAC,CAAC,CAAC;IACpD,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM;IAC1B,IAAI,OAAO,GAAG,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;IACjC,IAAI,SAAS,GAAG,CAAC,OAAO,GAAG,GAAG,EAAE,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,OAAO,IAAI,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,OAAO,IAAI,EAAE,CAAC,GAAG,GAAG,CAAC,CAAC;IACpG,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,+BAA+B,EAAE,CAAC,CAAC;IACzH,MAAM,CAAC,IAAI,CAAC;AACd,CAAC;AAED,oBAAoB,OAAO,EAAE,GAAG;IAC9B,MAAM,CAAC,IAAI,GAAG,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC;AACpC,CAAC;AACD,mBAAmB,GAAG;IACpB,MAAM,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;AAC7B,CAAC;AAED,oBAAoB,QAAQ;IAC1B,EAAE,CAAC,CAAC,QAAQ,CAAC,UAAU,KAAK,SAAS,CAAC,CAAC,CAAC;QACtC,QAAQ,EAAE,CAAC;QACX,MAAM,CAAC;IACT,CAAC;IACD,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,gBAAgB,CAAC;QAC7D,QAAQ,CAAC,mBAAmB,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;QACzD,QAAQ,EAAE,CAAC;IACb,CAAC,CAAC,CAAC;AACL,CAAC;AAED;IACE,IAAI,WAAW,GAAG,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC;AACjE,CAAC;AAED,0BAA0B,EAAE;IAC1B,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACR,MAAM,CAAC,EAAE,CAAC;IACZ,CAAC;IACD,EAAE,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC;QACxB,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IACnB,CAAC;IACD,IAAI,MAAM,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC3B,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACvC,IAAI,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC9B,IAAI,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;QAC/B,GAAG,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,GAAG,kBAAkB,CAAC,KAAK,CAAC,CAAC;IAC3D,CAAC;IACD,MAAM,CAAC,GAAG,CAAC;AACb,CAAC;AAED,yBAAyB,IAAI,EAAE,MAAM,EAAE,MAAM;IAC3C,sBAAsB,IAAI;QACxB,IAAI,CAAC,IAAI,GAAG,4BAA4B,CAAC;QACzC,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IACnC,CAAC;IAED,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;IAC/B,IAAI,GAAG,GAAG,IAAI,cAAc,EAAE,CAAC;IAC/B,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAC/C,GAAG,CAAC,YAAY,GAAG,aAAa,CAAC;IACjC,GAAG,CAAC,MAAM,GAAG;QACX,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;YACvB,YAAY,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,cAAc,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC;YACrE,MAAM,CAAC;QACT,CAAC;QACD,IAAI,IAAI,GAAG,IAAI,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACxC,YAAY,CAAC,EAAE,KAAK,EAAE,UAAU,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;QAC1F,YAAY,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC;IACnC,CAAC,CAAC;IACF,GAAG,CAAC,OAAO,GAAG;QACZ,YAAY,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAC;IACvD,CAAC,CAAC;IACF,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,CAAC;IAChC,YAAY,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAC;AAClC,CAAC;AAED,6DAA6D;AAC7D,gCAAgC,MAAM,EAAE,OAAO;IAC7C,MAAM,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;QACvB,KAAK,MAAM;YACT,IAAI,wBAAwB,GAAG,IAAI,CAAC;YACpC,MAAM,CAAC,yBAAyB,GAAG,UAAU,YAAY;gBACvD,OAAO,CAAC,GAAG,CAAC,6BAA6B,GAAG,YAAY,CAAC,CAAC;gBAC1D,IAAI,CAAC,YAAY,CAAC,GAAG;oBACnB,IAAI,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;oBACpD,OAAO,CAAC,GAAG,CAAC,mBAAmB,GAAG,YAAY,CAAC,CAAC;oBAChD,IAAI,MAAM,GAAG,wBAAwB,CAAC,kBAAkB,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;oBAC7E,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC7B,CAAC,CAAC;YACJ,CAAC,CAAC;YACF,MAAM,CAAC,2BAA2B,GAAG,UAAU,YAAY;gBACzD,OAAO,CAAC,GAAG,CAAC,+BAA+B,GAAG,YAAY,CAAC,CAAC;gBAC5D,OAAO,IAAI,CAAC,YAAY,CAAC,CAAC;YAC5B,CAAC,CAAC;YACF,EAAE,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC;gBAC1B,KAAK,CAAC;YACR,CAAC;YACD,MAAM,CAAC,cAAc,GAAG,wBAAwB,GAAG;gBACjD,MAAM,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;oBACnB,KAAK,SAAS;wBACZ,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC;oBACtC,KAAK,QAAQ;wBACX,MAAM,CAAC,UAAU,GAAG,GAAG,GAAG,WAAW,CAAC;oBACxC,KAAK,QAAQ;wBACX,EAAE,CAAC,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC;4BACjB,MAAM,CAAC,SAAS,CAAC;wBACnB,CAAC;wBACD,EAAE,CAAC,CAAC,gBAAgB,IAAI,GAAG,IAAI,GAAG,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;4BAC5D,QAAQ;4BACR,IAAI,GAAG,GAAG,SAAS,CAAC;4BACpB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gCACpC,GAAG,IAAI,gBAAgB,GAAG,CAAC,GAAG,IAAI,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,aAAa,CAAC;4BAC9E,CAAC;4BACD,MAAM,CAAC,GAAG,GAAG,UAAU,CAAC;wBAC1B,CAAC;wBACD,IAAI,GAAG,GAAG,UAAU,CAAC;wBACrB,GAAG,CAAC,CAAC,IAAI,GAAG,IAAI,GAAG,CAAC,CAAC,CAAC;4BACpB,GAAG,IAAI,gBAAgB,GAAG,GAAG,GAAG,IAAI,GAAG,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,aAAa,CAAC;wBAClF,CAAC;wBACD,MAAM,CAAC,GAAG,GAAG,WAAW,CAAC;oBAC3B,KAAK,QAAQ;wBACX,MAAM,CAAC,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,CAAC,GAAG,WAAW,CAAC;oBAC3G,KAAK,WAAW;wBACd,MAAM,CAAC,cAAc,CAAC;gBAC1B,CAAC;gBACD,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAA;YACxC,CAAC,CAAC;YACF,MAAM,CAAC,aAAa,GAAG,UAAU,IAAI;gBACnC,OAAO,CAAC,GAAG,CAAC,iBAAiB,GAAG,IAAI,CAAC,CAAC;gBACtC,6DAA6D;gBAC7D,kEAAkE;gBAClE,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3B,CAAC,CAAC;YACF,MAAM,CAAC,aAAa,GAAG,UAAU,IAAI;gBACnC,OAAO,CAAC,GAAG,CAAC,2BAA2B,GAAG,IAAI,CAAC,CAAC;YAClD,CAAC,CAAC;YACF,KAAK,CAAC;QACR,KAAK,OAAO;YACV,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC,EAAE,CAAC;YAC3B,KAAK,CAAC;QACR,KAAK,MAAM;YACT,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAC1D,KAAK,CAAC;QACR,KAAK,MAAM;YACT,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YACvD,KAAK,CAAC;QACR,KAAK,UAAU;YACb,MAAM,CAAC,yBAAyB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YACvD,KAAK,CAAC;QACR,KAAK,YAAY;YACf,MAAM,CAAC,2BAA2B,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YACzD,KAAK,CAAC;IACV,CAAC;AACH,CAAC","sourcesContent":["interface ITransportPeer {\r\n    onAsyncMessage: (msg: any) => void;\r\n    onSyncMessage: (msg: any) => any;\r\n\r\n    postAsyncMessage(msg: any, transfers?: any[]): void;\r\n\r\n    sendSyncMessage(msg: any, transfers?: any[]): any;\r\n}\r\n\r\nclass MozTransprotPeer implements ITransportPeer {\r\n    public window: Window;\r\n    public target: Window;\r\n    private _name: string;\r\n\r\n    constructor(window: Window, target: Window, name: string) {\r\n        this.target = target;\r\n        this.window = window;\r\n        this._name = name;\r\n    }\r\n\r\n    set onAsyncMessage(callback: (msg: any) => void) {\r\n        this.window.addEventListener('message', (e) => {\r\n            Promise.resolve(e.data).then((msg) => { // delay\r\n                // console.log('received async', this._name, msg);\r\n                callback(msg);\r\n            });\r\n        });\r\n    }\r\n\r\n    set onSyncMessage(callback: (msg: any) => any) {\r\n        this.window.addEventListener('syncmessage', (e) => {\r\n            let wrappedMessage = (<any>e).detail;\r\n            let msg: any = wrappedMessage.msg;\r\n            // console.log('received sync', this._name, msg);\r\n            wrappedMessage.result = callback(msg);\r\n        });\r\n    }\r\n\r\n\r\n    postAsyncMessage(msg: any, transfers?: any[]): void {\r\n        //console.log('sending async', this._name, msg, transfers);\r\n        this.target.postMessage(msg, '*', transfers);\r\n    }\r\n\r\n    sendSyncMessage(msg: any, transfers?: any[]): any {\r\n        //console.log('sending sync', this._name, msg, transfers);\r\n        let event = this.target.document.createEvent('CustomEvent');\r\n        let wrappedMessage = {\r\n            msg: msg,\r\n            result: undefined as any\r\n        };\r\n        event.initCustomEvent('syncmessage', false, false, wrappedMessage);\r\n        this.target.dispatchEvent(event);\r\n        return wrappedMessage.result;\r\n    }\r\n}\r\n\r\n\r\nclass PandaTransprotPeer implements ITransportPeer {\r\n    private static _aloneHash: { [key: string]: PandaTransprotPeer } = {};\r\n    private static _counter: number = 0;\r\n    private _another: PandaTransprotPeer = null;\r\n    private _syncCallBack: (msg: any) => any;\r\n    private _name: string = null;\r\n\r\n    constructor(key: string, name: string) {\r\n        this._name = name;\r\n        console.log('PandaTransprotPeer::ctor, key:', key, 'name', this._name, 'counter:', PandaTransprotPeer._counter);\r\n        PandaTransprotPeer._counter++;\r\n        let another = PandaTransprotPeer._aloneHash[key];\r\n        if (another) {\r\n            another._another = this;\r\n            this._another = another;\r\n            delete PandaTransprotPeer._aloneHash[key];\r\n            console.log('PandaTransprotPeer::connected');\r\n        } else {\r\n            PandaTransprotPeer._aloneHash[key] = this;\r\n            console.log('PandaTransprotPeer::created alone');\r\n        }\r\n    }\r\n\r\n    set onAsyncMessage(callback: (msg: any) => void) {\r\n        window.addEventListener('message', (e) => {\r\n            let rawMessage = e.data;\r\n            if (this.isPandaWrappedMessageFromAnother(rawMessage)) {\r\n                let msg = rawMessage.payload;\r\n                Promise.resolve().then(() => { // delay\r\n                    callback(msg);\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    private isPandaWrappedMessageFromAnother(msg: any): msg is PandaWrappedMessage {\r\n        if ('from' in msg && 'payload' in msg) {\r\n            if (this._another) {\r\n                if (msg.from == this._another._name) {\r\n                    return true;\r\n                }\r\n            } else {\r\n                console.log(this._name, 'received PandaWrappedMessage from', msg.from, 'but has no this._another link');\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    postAsyncMessage(msg: any, transfers?: any[]): void {\r\n        //console.log('sending async', this._name, msg, transfers);\r\n        let wrapped = new PandaWrappedMessage(msg, this._name);\r\n        window.postMessage(wrapped, '*', transfers);\r\n    }\r\n\r\n    set onSyncMessage(callback: (msg: any) => any) {\r\n        this._syncCallBack = callback;\r\n    }\r\n\r\n    sendSyncMessage(msg: any, transfers?: any[]): any {\r\n        //console.log('sending sync', this._name, msg, transfers);\r\n        let callback = this._another ? this._another._syncCallBack : null;\r\n        if (callback) {\r\n            return callback(msg);\r\n        }\r\n    }\r\n}\r\n\r\nclass PandaWrappedMessage {\r\n    public payload: any;\r\n    public from: string;\r\n    public constructor(payload: any, from: string) {\r\n        this.payload = payload;\r\n        this.from = from;\r\n    }\r\n}","///ts:ref=transportPeer\r\n/// <reference path=\"./transportPeer.ts\"/> ///ts:ref:generated\r\n// Implements most of APIs from https://code.google.com/p/swfobject/wiki/api\r\nclass ShumwayObject {\r\n\r\n  private _lastScriptElement: HTMLScriptElement;\r\n  private _shumwayHome: string;\r\n  // Checking if viewer is hosted remotely\r\n  private _shumwayRemote: boolean;\r\n  private _originalCreateElement = document.createElement;\r\n  private _cachedQueryParams;\r\n  private _enabledRemoteOrigins: any;\r\n  public constructor() {\r\n    // Using last loaded script director as a base for Shumway resources\r\n    this._lastScriptElement = (document.body || document.getElementsByTagName('head')[0]).lastChild as HTMLScriptElement;\r\n    this._shumwayHome = combineUrl(this._lastScriptElement.src, '.');\r\n    // Checking if viewer is hosted remotely\r\n    this._shumwayRemote = getOrigin(document.location.href) !== getOrigin(this._shumwayHome);\r\n    this._enabledRemoteOrigins = null;\r\n  }\r\n  private setupRemote(origin) {\r\n    if (!this._enabledRemoteOrigins) {\r\n      window.addEventListener('message', (e) => {\r\n        var data = e.data;\r\n        if (typeof data !== 'object' || data === null || data.type !== 'shumwayFileLoading') {\r\n          return;\r\n        }\r\n        if (!this._enabledRemoteOrigins[e.origin]) {\r\n          return;\r\n        }\r\n        fetchRemoteFile(data, e.source, e.origin);\r\n      });\r\n      this._enabledRemoteOrigins = Object.create(null);\r\n    }\r\n    this._enabledRemoteOrigins[origin] = true;\r\n  }\r\n\r\n  // Creates Shumway iframe\r\n  private _createSWF(swfUrl, id, width, height, flashvars, params, attributes): HTMLIFrameElement & { shumway: ShumwayBindings } {\r\n    var cssStyle;\r\n    if (attributes) {\r\n      swfUrl = swfUrl || attributes['data'];\r\n      id = attributes['id'] || id;\r\n      width = width || attributes['width'];\r\n      height = height || attributes['height'];\r\n      cssStyle = attributes['style'];\r\n    }\r\n\r\n    var viewerUrl = combineUrl(this._shumwayHome, 'iframe/viewer.html');\r\n    var absoluteSwfUrl = combineUrl(getDocumentBase(), swfUrl);\r\n\r\n    var iframeElement = document.createElement('iframe');\r\n    if (width) {\r\n      iframeElement.width = width;\r\n    }\r\n    if (height) {\r\n      iframeElement.height = height;\r\n    }\r\n    iframeElement.setAttribute('id', id);\r\n    if (attributes) {\r\n      Object.keys(attributes).forEach((name) => {\r\n        switch (name.toLowerCase()) {\r\n          case 'styleclass':\r\n            iframeElement.setAttribute('class', attributes[name]);\r\n            break;\r\n          case 'class':\r\n          case 'name':\r\n          case 'align':\r\n            iframeElement.setAttribute(name, attributes[name]);\r\n            break;\r\n        }\r\n      });\r\n    }\r\n\r\n    var objectParams = {};\r\n    var flashBase;\r\n    if (params) {\r\n      Object.keys(params).forEach((name) => {\r\n        name = name.toLowerCase();\r\n        if (name === 'flashvars') {\r\n          if (!flashvars) {\r\n            flashvars = parseQueryString(params[name]);\r\n          }\r\n        } else if (name === 'base') {\r\n          // Base param, send as baseUrl in pluginParams below\r\n          flashBase = combineUrl(getDocumentBase(), params[name]);\r\n        }\r\n        objectParams[name] = params[name];\r\n      });\r\n    }\r\n    var movieParams = {};\r\n    if (flashvars) {\r\n      var flashvarsParts = [];\r\n      Object.keys(flashvars).forEach((name) => {\r\n        movieParams[name] = flashvars[name];\r\n        flashvarsParts.push(encodeURIComponent(name) + '=' + encodeURIComponent(flashvars[name]));\r\n      });\r\n      if (flashvarsParts.length > 0) {\r\n        objectParams['flashvars'] = flashvarsParts.join('&');\r\n      }\r\n    }\r\n\r\n    var pluginParams = {\r\n      baseUrl: flashBase || getDocumentBase(),\r\n      url: absoluteSwfUrl,\r\n      movieParams: movieParams,\r\n      objectParams: objectParams,\r\n      isRemote: this._shumwayRemote\r\n    };\r\n    if (this._shumwayRemote) {\r\n      this.setupRemote(getOrigin(viewerUrl));\r\n    }\r\n    iframeElement.src = viewerUrl;\r\n    iframeElement.setAttribute('frameborder', '0');\r\n    if (cssStyle) {\r\n      iframeElement.setAttribute('style', cssStyle);\r\n    }\r\n    let load = (e) => {\r\n      iframeElement.removeEventListener('load', load);\r\n      iframeElement.contentWindow.postMessage({ type: 'pluginParams', flashParams: pluginParams }, '*');\r\n    }\r\n    iframeElement.addEventListener('load', load);\r\n    return iframeElement as any;\r\n  }\r\n\r\n  // Replaces initial DOM element with Shumway iframe.\r\n  private _embedSWF(element, swfUrl, id, width, height, flashvars, params, attributes, callbackFn) {\r\n    var iframeElement = this._createSWF(swfUrl, id, width, height, flashvars, params, attributes);\r\n    let load = (e) => {\r\n      iframeElement.removeEventListener('load', load);\r\n      if (this._shumwayRemote) {\r\n        // It's not possible expose the external interface or internals of\r\n        // the Shumway, because iframeElement.contentDocument is not available.\r\n        if (callbackFn) {\r\n          callbackFn({ success: true, id: iframeElement.id, ref: iframeElement });\r\n        }\r\n        return;\r\n      }\r\n      var contentDocument = iframeElement.contentDocument;\r\n      let started = e => {\r\n        contentDocument.removeEventListener('shumwaystarted', started, true);\r\n        iframeElement.shumway = new ShumwayBindings(iframeElement);\r\n        if (callbackFn) {\r\n          callbackFn({ success: true, id: iframeElement.id, ref: iframeElement });\r\n        }\r\n      }\r\n      contentDocument.addEventListener('shumwaystarted', started, true);\r\n    }\r\n    iframeElement.addEventListener('load', load);\r\n    element.parentNode.replaceChild(iframeElement, element);\r\n  }\r\n\r\n  // Copies parameters/attributes from the DOM element and replaces it.\r\n  private replaceBySWF(element, id, callbackFn) {\r\n    // import parameters\r\n    var width = element.getAttribute('width');\r\n    var height = element.getAttribute('height');\r\n    var swfUrl = element.getAttribute('data');\r\n    var attributes = {\r\n      id: element.getAttribute('id'),\r\n      name: element.getAttribute('name'),\r\n      \"class\": element.getAttribute('class'),\r\n      align: element.getAttribute('align'),\r\n      style: element.getAttribute('style')\r\n    };\r\n    var paramNodes = element.getElementsByTagName('param');\r\n    var params = {};\r\n    for (var i = 0; i < paramNodes.length; i++) {\r\n      var paramName = paramNodes[i].getAttribute('name');\r\n      var paramValue = paramNodes[i].getAttribute('value');\r\n      if (!paramName) {\r\n        continue;\r\n      }\r\n      params[paramName.toLowerCase()] = paramValue;\r\n    }\r\n    if (!swfUrl) {\r\n      swfUrl = params['src'] || params['movie'];\r\n    }\r\n    this._embedSWF(element, swfUrl, id, width, height, undefined, params, attributes, callbackFn);\r\n  }\r\n\r\n  private createAndMonitorShadowObject() {\r\n    var xObject = this._originalCreateElement.call(document, 'x-shu-object');\r\n    var observer = new MutationObserver((mutations) => {\r\n      for (let mutation of mutations) {\r\n        var addedNodes = mutation.addedNodes;\r\n        if (!addedNodes || addedNodes.length === 0) {\r\n          break;\r\n        }\r\n        for (var i = 0; i < addedNodes.length; i++) {\r\n          if (addedNodes[i] === xObject) {\r\n            this.replaceBySWF(xObject, undefined, undefined);\r\n            observer.disconnect();\r\n            break;\r\n          }\r\n        }\r\n      };\r\n    });\r\n    observer.observe(document, { childList: true, subtree: true });\r\n    return xObject;\r\n  }\r\n\r\n  /**\r\n   * Specifies the location of the Shumway base folder.\r\n   */\r\n  get shumwayHome() {\r\n    return this._shumwayHome;\r\n  }\r\n\r\n  set shumwayHome(value) {\r\n    this._shumwayHome = combineUrl(document.location.href, value);\r\n  }\r\n\r\n  /**\r\n   * Specifies if Shumway shall take in account cross-domain policies.\r\n   *\r\n   * When true is set, SWF files will be requested by the main page, external\r\n   * interface is disable and Shumway internal objects are not available.\r\n   */\r\n  get shumwayRemote() {\r\n    return this._shumwayRemote;\r\n  }\r\n\r\n  set shumwayRemote(value) {\r\n    this._shumwayRemote = !!value;\r\n  }\r\n\r\n  public registerObject(id, version, expressInstallSwfurl, callbackFn) {\r\n    onDOMReady(() => {\r\n      var element = document.getElementById(id);\r\n      if (!element) {\r\n        throw new Error('element ' + id + ' was not found');\r\n      }\r\n      this.replaceBySWF(element, id, callbackFn);\r\n    });\r\n  }\r\n  public embedSWF(swfUrl, id, width, height, version, expressInstallSwfurl, flashvars, params, attributes, callbackFn) {\r\n    onDOMReady(() => {\r\n      var element = document.getElementById(id);\r\n      if (!element) {\r\n        throw new Error('element ' + id + ' was not found');\r\n      }\r\n      this._embedSWF(element, swfUrl, id, width, height, flashvars, params, attributes, callbackFn);\r\n    });\r\n  }\r\n  public getObjectById(id) {\r\n    return document.getElementById(id);\r\n  }\r\n  public getFlashPlayerVersion() {\r\n    return { major: 10, minor: 0, release: 0 };\r\n  }\r\n  public hasFlashPlayerVersion(version) {\r\n    return true;\r\n  }\r\n  public addLoadEvent(fn) {\r\n    onDOMReady(fn);\r\n  }\r\n  public addDomLoadEvent(fn) {\r\n    onDOMReady(fn);\r\n  }\r\n  public createSWF(attributes, params, id) {\r\n    var element = document.getElementById(id);\r\n    if (!element) {\r\n      throw new Error('element ' + id + ' was not found');\r\n    }\r\n    var iframeElement = this._createSWF(undefined, id, undefined, undefined, undefined, params, attributes);\r\n    element.parentNode.replaceChild(iframeElement, element);\r\n    return iframeElement;\r\n  }\r\n  public removeSWF (id) {\r\n    var element = document.getElementById(id);\r\n    element.parentNode.removeChild(element);\r\n  }\r\n  public buildEmptySWF (swfVersion, width, height, framerate, avm2, background) {\r\n    return URL.createObjectURL(createEmptySWFBlob(swfVersion, width, height, framerate, avm2, background));\r\n  }\r\n  \r\n  public createElement (name) {\r\n    if (typeof name !== 'string' || name.toLowerCase() !== 'object') {\r\n      return this._originalCreateElement.apply(document, arguments);\r\n    }\r\n    return this.createAndMonitorShadowObject();\r\n  }\r\n  public getShumwayObject(idOrElement) {\r\n    var element = typeof idOrElement === 'string' ? document.getElementById(idOrElement) : idOrElement;\r\n    if (!element) {\r\n      throw new Error('element ' + idOrElement + ' was not found');\r\n    }\r\n    return element.shumway;\r\n  }\r\n  public getQueryParamValue(paramName) {\r\n    if (!this._cachedQueryParams) {\r\n      this._cachedQueryParams = parseQueryString(document.location.search);\r\n    }\r\n    return this._cachedQueryParams[paramName];\r\n  }\r\n  public hack(scope, setNavigatorPlugins) {\r\n    scope = scope || 'all';\r\n    let self = this;\r\n    document.createElement = function (name) {\r\n      if (typeof name !== 'string' || name.toLowerCase() !== 'object') {\r\n        return self._originalCreateElement.apply(document, arguments);\r\n      }\r\n      if (scope === 'all') {\r\n        return self.createAndMonitorShadowObject();\r\n      } else {\r\n        return self._originalCreateElement.apply(document, arguments);\r\n      }\r\n    };\r\n    var pluginName = 'Shockwave Flash';\r\n    var mimeTypeName = 'application/x-shockwave-flash';\r\n    if (setNavigatorPlugins && !window.navigator.plugins[pluginName]) {\r\n      var mimeType: any = {\r\n        description: \"Shockwave Flash\",\r\n        suffixes: 'swf',\r\n        type: mimeTypeName\r\n      };\r\n      window.navigator.mimeTypes[mimeTypeName] = mimeType;\r\n      var plugin = {\r\n        description: 'Shockwave Flash 10.0 r0 compatible',\r\n        filename: 'shumway.js',\r\n        length: 1,\r\n        name: pluginName,\r\n        '0': mimeType\r\n      };\r\n      mimeType.enabledPlugin = plugin;\r\n      window.navigator.plugins[pluginName] = plugin;\r\n    }\r\n  }\r\n  ua: {\r\n    w3: true,\r\n    pv: [10, 0, 0]\r\n  }\r\n}\r\n\r\nvar shuobject = new ShumwayObject();\r\n\r\n\r\ninterface Window {\r\n  __flash__toXML: (obj: any) => string;\r\n  __flash__eval: (exp: any) => void;\r\n  __flash__call: (exp: any) => void;\r\n  eval: (...any) => void;\r\n}\r\n\r\n// Exposed as the 'shumway' property in the Shumway iframe, contains:\r\n// stage, flash namespace, and other Shumway utils.\r\nclass ShumwayBindings {\r\n  public sec: any;\r\n  public stage: any;\r\n  public Shumway: any;\r\n  public flash: any;\r\n  public easelHost: any;\r\n  public onFrame: any;\r\n  public onFSCommand: any;\r\n\r\n  constructor(iframeElement: HTMLIFrameElement & any) {\r\n    var gfxWindow = iframeElement.contentWindow.gfxWindow;\r\n    var easelHost = gfxWindow.easelHost;\r\n    easelHost.processFrame = this.processFrame.bind(this, iframeElement);\r\n    easelHost.processFSCommand = this.processFSCommand.bind(this, iframeElement);\r\n\r\n    var playerWindow = iframeElement.contentWindow.playerWindow;\r\n    var externalInterfaceService = playerWindow.iframeExternalInterface;\r\n    externalInterfaceService.processExternalCommand = processExternalCommand.bind(externalInterfaceService, iframeElement);\r\n\r\n    this.sec = playerWindow.player.sec;\r\n    this.stage = playerWindow.player.stage;\r\n    this.Shumway = playerWindow.Shumway;\r\n    this.flash = playerWindow.player.sec.flash;\r\n    this.easelHost = easelHost;\r\n\r\n    this.onFrame = null;\r\n    this.onFSCommand = null;\r\n  }\r\n\r\n  public takeScreenshot(options) {\r\n    options = options || {};\r\n    var bounds = options.bounds || null;\r\n    var stageContent = !!options.stageContent;\r\n    var disableHidpi = !!options.disableHidpi;\r\n\r\n    var easel = this.easelHost.easel;\r\n    easel.render();\r\n    return easel.screenShot(bounds, stageContent, disableHidpi);\r\n  }\r\n  private processFrame(iframeElement) {\r\n    var onFrame = iframeElement.shumway.onFrame;\r\n    if (onFrame) {\r\n      onFrame();\r\n    }\r\n  }\r\n  private processFSCommand(iframeElement, command, args) {\r\n    var onFSCommand = iframeElement.shumway.onFSCommand;\r\n    if (onFSCommand) {\r\n      return onFSCommand(command, args);\r\n    }\r\n  }\r\n}\r\n\r\nfunction createEmptySWFBlob(swfVersion, width, height, framerate, avm2, background) {\r\n  var headerBytes = [0x46, 0x57, 0x53, swfVersion]; // 'FWS'\r\n  var swfBody = [];\r\n\r\n  // Encoding SWF dimensions\r\n  var bitsPerSizeComponent = 15;\r\n  var buffer = bitsPerSizeComponent, bufferSize = 5;\r\n  buffer = (buffer << bitsPerSizeComponent); bufferSize += bitsPerSizeComponent;\r\n  while (bufferSize > 8) {\r\n    swfBody.push((buffer >> (bufferSize -= 8)) & 255);\r\n  }\r\n  buffer = (buffer << bitsPerSizeComponent) | (width * 20); bufferSize += bitsPerSizeComponent;\r\n  while (bufferSize > 8) {\r\n    swfBody.push((buffer >> (bufferSize -= 8)) & 255);\r\n  }\r\n  buffer = (buffer << bitsPerSizeComponent); bufferSize += bitsPerSizeComponent;\r\n  while (bufferSize > 8) {\r\n    swfBody.push((buffer >> (bufferSize -= 8)) & 255);\r\n  }\r\n  buffer = (buffer << bitsPerSizeComponent) | (height * 20); bufferSize += bitsPerSizeComponent;\r\n  while (bufferSize > 8) {\r\n    swfBody.push((buffer >> (bufferSize -= 8)) & 255);\r\n  }\r\n  if (bufferSize > 0) {\r\n    swfBody.push((buffer << (8 - bufferSize)) & 255);\r\n  }\r\n\r\n  swfBody.push(((framerate - (framerate | 0)) * 255) | 0, framerate | 0);\r\n  swfBody.push(1, 0); // frame count\r\n  var attributesTagCode = (69 << 6) | 4;\r\n  swfBody.push(attributesTagCode & 255, attributesTagCode >> 8, (avm2 ? 8 : 0), 0, 0, 0);\r\n  if (background !== undefined) {\r\n    var backgroundTagCode = (9 << 6) | 3;\r\n    swfBody.push(backgroundTagCode & 255, backgroundTagCode >> 8,\r\n      (background >> 16) & 255, (background >> 8) & 255, background & 255);\r\n  }\r\n  var frameTagCode = (1 << 6) | 0;\r\n  swfBody.push(frameTagCode & 255, frameTagCode >> 8);\r\n  swfBody.push(0, 0); // end\r\n  var swfSize = swfBody.length + 8;\r\n  var sizeBytes = [swfSize & 255, (swfSize >> 8) & 255, (swfSize >> 16) & 255, (swfSize >> 24) & 255];\r\n  var blob = new Blob([new Uint8Array(headerBytes.concat(sizeBytes, swfBody))], { type: 'application/x-shockwave-flash' });\r\n  return blob;\r\n}\r\n\r\nfunction combineUrl(baseUrl, url) {\r\n  return new URL(url, baseUrl).href;\r\n}\r\nfunction getOrigin(url) {\r\n  return new URL(url).origin;\r\n}\r\n\r\nfunction onDOMReady(callback) {\r\n  if (document.readyState !== 'loading') {\r\n    callback();\r\n    return;\r\n  }\r\n  document.addEventListener('DOMContentLoaded', function loaded(e) {\r\n    document.removeEventListener('DOMContentLoaded', loaded);\r\n    callback();\r\n  });\r\n}\r\n\r\nfunction getDocumentBase() {\r\n  var baseElement = document.getElementsByTagName('base')[0];\r\n  return baseElement ? baseElement.href : document.location.href;\r\n}\r\n\r\nfunction parseQueryString(qs) {\r\n  if (!qs) {\r\n    return {};\r\n  }\r\n  if (qs.charAt(0) == '?') {\r\n    qs = qs.slice(1);\r\n  }\r\n  var values = qs.split('&');\r\n  var obj = {};\r\n  for (var i = 0; i < values.length; i++) {\r\n    var kv = values[i].split('=');\r\n    var key = kv[0], value = kv[1];\r\n    obj[decodeURIComponent(key)] = decodeURIComponent(value);\r\n  }\r\n  return obj;\r\n}\r\n\r\nfunction fetchRemoteFile(data, target, origin) {\r\n  function sendResponse(args) {\r\n    args.type = 'shumwayFileLoadingResponse';\r\n    args.sessionId = sessionId;\r\n    target.postMessage(args, origin);\r\n  }\r\n\r\n  var sessionId = data.sessionId;\r\n  var xhr = new XMLHttpRequest();\r\n  xhr.open(data.method || 'GET', data.url, true);\r\n  xhr.responseType = 'arraybuffer';\r\n  xhr.onload = function () {\r\n    if (xhr.status !== 200) {\r\n      sendResponse({ topic: 'error', error: 'XHR status: ' + xhr.status });\r\n      return;\r\n    }\r\n    var data = new Uint8Array(xhr.response);\r\n    sendResponse({ topic: 'progress', array: data, loaded: data.length, total: data.length });\r\n    sendResponse({ topic: 'close' });\r\n  };\r\n  xhr.onerror = function () {\r\n    sendResponse({ topic: 'error', error: 'XHR error' });\r\n  };\r\n  xhr.send(data.postData || null);\r\n  sendResponse({ topic: 'open' });\r\n}\r\n\r\n// Initializes and performs external interface communication.\r\nfunction processExternalCommand(iframe, command) {\r\n  switch (command.action) {\r\n    case 'init':\r\n      var externalInterfaceService = this;\r\n      iframe.__flash__registerCallback = function (functionName) {\r\n        console.log('__flash__registerCallback: ' + functionName);\r\n        this[functionName] = function () {\r\n          var args = Array.prototype.slice.call(arguments, 0);\r\n          console.log('__flash__callIn: ' + functionName);\r\n          var result = externalInterfaceService.onExternalCallback(functionName, args);\r\n          return window.eval(result);\r\n        };\r\n      };\r\n      iframe.__flash__unregisterCallback = function (functionName) {\r\n        console.log('__flash__unregisterCallback: ' + functionName);\r\n        delete this[functionName];\r\n      };\r\n      if (window.__flash__toXML) {\r\n        break;\r\n      }\r\n      window.__flash__toXML = function __flash__toXML(obj) {\r\n        switch (typeof obj) {\r\n          case 'boolean':\r\n            return obj ? '<true/>' : '<false/>';\r\n          case 'number':\r\n            return '<number>' + obj + '</number>';\r\n          case 'object':\r\n            if (obj === null) {\r\n              return '<null/>';\r\n            }\r\n            if ('hasOwnProperty' in obj && obj.hasOwnProperty('length')) {\r\n              // array\r\n              var xml = '<array>';\r\n              for (let i = 0; i < obj.length; i++) {\r\n                xml += '<property id=\"' + i + '\">' + __flash__toXML(obj[i]) + '</property>';\r\n              }\r\n              return xml + '</array>';\r\n            }\r\n            var xml = '<object>';\r\n            for (let key in obj) {\r\n              xml += '<property id=\"' + key + '\">' + __flash__toXML(obj[key]) + '</property>';\r\n            }\r\n            return xml + '</object>';\r\n          case 'string':\r\n            return '<string>' + obj.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</string>';\r\n          case 'undefined':\r\n            return '<undefined/>';\r\n        }\r\n        throw new Error('impossible obj type')\r\n      };\r\n      window.__flash__eval = function (expr) {\r\n        console.log('__flash__eval: ' + expr);\r\n        // allowScriptAccess protects page from unwanted swf scripts,\r\n        // we can execute script in the page context without restrictions.\r\n        return window.eval(expr);\r\n      };\r\n      window.__flash__call = function (expr) {\r\n        console.log('__flash__call (ignored): ' + expr);\r\n      };\r\n      break;\r\n    case 'getId':\r\n      command.result = iframe.id;\r\n      break;\r\n    case 'eval':\r\n      command.result = window.__flash__eval(command.expression);\r\n      break;\r\n    case 'call':\r\n      command.result = window.__flash__call(command.request);\r\n      break;\r\n    case 'register':\r\n      iframe.__flash__registerCallback(command.functionName);\r\n      break;\r\n    case 'unregister':\r\n      iframe.__flash__unregisterCallback(command.functionName);\r\n      break;\r\n  }\r\n}"]}